"""
GENERATED CODE - DO NOT EDIT MANUALLY
This file is generated from schema.zed and should not be modified directly.
"""

from abc import ABC
from typing import Literal, TypeVar, Generic, Any, overload, NamedTuple

class CheckRequest(NamedTuple):
    """A request to check a permission or relation."""
    subject_type: str
    subject_id: str
    subject_relation: str | None
    action: str  # The permission or relation name
    resource_type: str
    resource_id: str
    context: dict[str, Any] | None = None

# Permission literals for each resource type
{% for object_type, perms in permissions.items() %}
{% if perms %}
{{ object_type|capitalize }}Permission = Literal[{% for perm in perms %}"{{ perm }}"{% if not loop.last %}, {% endif %}{% endfor %}]
{% endif %}
{% endfor %}

# Relation literals for each resource type
{% for object_type, rels in relations.items() %}
{% if rels %}
{{ object_type|capitalize }}Relation = Literal[{% for rel in rels %}"{{ rel }}"{% if not loop.last %}, {% endif %}{% endfor %}]
{% endif %}
{% endfor %}

# Abstract base class for all resources
class Resource(ABC):
    """Abstract base class for all resources."""
    def __init__(self, id: str, subject_relation: str | None = None):
        self.id = id
        self.type = ""  # Will be overridden by subclasses
        self.subject_relation = subject_relation

# Resource types from schema
{% for object_type in object_types %}
class {{ object_type|capitalize }}(Resource):
    """{{ object_type|capitalize }} resource from schema.zed"""
    def __init__(self, id: str, subject_relation: str | None = None):
        super().__init__(id, subject_relation)
        self.type = "{{ object_type }}"
{% endfor %}

# Type variable for resources
T = TypeVar('T', bound=Resource)  # Constrain T to be a subclass of Resource

# DSL implementation
class ResourceCheck(Generic[T]):
    """First step in the permission check chain."""
    def __init__(self, resource: T):
        self.resource = resource
    
    def check_that(self, subject: Resource) -> "SubjectCheck[T]":
        """
        Check that the subject has permissions on the resource.
        
        Args:
            subject: The subject to check permissions for (another resource)
            
        Returns:
            A SubjectCheck object to continue the permission check chain
        """
        return SubjectCheck(self.resource, subject)

class SubjectCheck(Generic[T]):
    """Second step in the permission check chain."""
    def __init__(self, resource: T, subject: Resource):
        self.resource = resource
        self.subject = subject
    
    {% for object_type, perms in permissions.items() %}
    {% if perms %}
    @overload
    def can(self: "SubjectCheck[{{ object_type|capitalize }}]", permission: {{ object_type|capitalize }}Permission, context: dict[str, Any] | None = None) -> CheckRequest: ...
    {% endif %}
    {% endfor %}
    
    def can(self, permission: str, context: dict[str, Any] | None = None) -> CheckRequest:
        """
        Create a permission check request.
        
        Args:
            permission: The permission to check
            context: Additional context for the permission check (optional)
            
        Returns:
            A CheckRequest object
        """
        return CheckRequest(
            subject_type=self.subject.type,
            subject_id=self.subject.id,
            subject_relation=self.subject.subject_relation,
            action=permission,
            resource_type=self.resource.type,
            resource_id=self.resource.id,
            context=context
        )
    
    {% for object_type, rels in relations.items() %}
    {% if rels %}
    @overload
    def is_(self: "SubjectCheck[{{ object_type|capitalize }}]", relation: {{ object_type|capitalize }}Relation, context: dict[str, Any] | None = None) -> CheckRequest: ...
    {% endif %}
    {% endfor %}
    
    def is_(self, relation: str, context: dict[str, Any] | None = None) -> CheckRequest:
        """
        Create a relation check request.
        
        Args:
            relation: The relation to check
            context: Additional context for the relation check (optional)
            
        Returns:
            A CheckRequest object
        """
        return CheckRequest(
            subject_type=self.subject.type,
            subject_id=self.subject.id,
            subject_relation=self.subject.subject_relation,
            action=relation,
            resource_type=self.resource.type,
            resource_id=self.resource.id,
            context=context
        )

def on_resource(resource: T) -> ResourceCheck[T]:
    """
    Start a permission check chain for the specified resource.
    
    Args:
        resource: The resource to check permissions on
        
    Returns:
        A ResourceCheck object to continue the permission check chain
    """
    return ResourceCheck(resource)
